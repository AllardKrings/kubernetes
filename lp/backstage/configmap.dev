apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: backstage
data:
  app-config.yaml: |
    app:
      title: Backstage-Dev
      baseUrl: https://backstage-dev.allarddcs.nl  # Frontend URL

    backend:
      baseUrl: https://backstage-dev.allarddcs.nl  # Backend URL (API)
      listen:
        port: 7007
      http:
        auth:
          environment: development
          providers:
            guest:
              development:
                allowEveryone: true
      cors:
        origin: https://backstage-dev.allarddcs.nl
        methods: [GET, POST, PUT, DELETE, PATCH]
        credentials: true
      trustProxy: true
      database:
        client: pg
        connection:
          host: ${POSTGRES_SERVICE_HOST}
          port: ${POSTGRES_SERVICE_PORT}
          user: ${POSTGRES_USER}
          password: ${POSTGRES_PASSWORD}
          database: ${POSTGRES_DB}

    integrations:
      gitea:
        - host: gitea-dev.allarddcs.nl
          apiBaseUrl: https://gitea-dev.allarddcs.nl/api/v1
          token: "7c289d89b02489984fc9850411bb26f6ee4e9d37"

    logging:
      logLevel: info
      loggers:
        catalog:
          level: debug
        backend:
          level: debug
    csp:
      connect-src: ["'self'", 'http:', 'https:']

    techdocs:
      builder: local
      generator:
        runIn: local
      publisher:
        type: local

    organization:
      name: AllardDCS
    rollbar:
      organization: my-company
      # NOTE: The rollbar-backend & accountToken key may be deprecated in the future (rep>
      accountToken: my-rollbar-account-token
    auth:
      environment: development
      providers:
        guest:
          development:
            allowEveryone: true  # Guest auth enabled

    permission:
      enabled: false  # Disable permission enforcement

    catalog:
      providers:
        gitea:
          yourProviderId:
            organization: 'allarddcs' # string
            host: gitea-dev.allarddcs.nl
            branch: 'master' # Optional, defaults to 'main'
            catalogPath: 'catalog-info.yaml' # Optional, defaults to catalog-info.yaml
            schedule:
              # supports cron, ISO duration, "human duration" as used in code
              frequency: { minutes: 30 }
              # supports ISO duration, "human duration" as used in code
              timeout: { minutes: 3 }
      locations:
        - type: url
          target: https://gitea-dev.allarddcs.nl/allard/kubernetes/raw/branch/master/group.yaml
          rules:
            - allow: [Group]

        - type: url
          target: https://gitea-dev.allarddcs.nl/allard/kubernetes/raw/branch/master/system.yaml
          rules:
            - allow: [System]

        - type: url
          target: https://gitea-dev.allarddcs.nl/allard/kubernetes/raw/branch/master/catalog-info.yaml
          rules:
            - allow: [Component]

      processors:
        gitea:
          - host: gitea-dev.allarddcs.nl
            apiBaseUrl: https://gitea-dev.allarddcs.nl/api/v1

    kubernetes:
      serviceLocatorMethod:
        type: multiTenant

      clusterLocatorMethods:
        - type: config
          clusters:
            - name: local-cluster
              url: https://kubernetes.default.svc
              authProvider: serviceAccount
